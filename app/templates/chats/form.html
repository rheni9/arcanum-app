{% extends "base.html" %}

{% block title %}{{ "Edit" if is_editing else "Add" }} Chat | Arcanum{% endblock %}

{% block content %}
  <h1 class="page-title">{{ "Edit" if is_editing else "Add" }} Chat</h1>

  {# === Flash Messages === #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages">
        {% for category, message in messages %}
          <div class="alert {{ 'alert-success' if category == 'success' else 'alert-error' }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {# === Chat Form === #}
  <form method="post" class="chat-form" action="{{ url_for('chats.save_chat') }}">
    {# hidden fields (for edit mode) #}
    {% if chat and chat.slug %}
      <input type="hidden" name="original_slug" value="{{ chat.slug }}">
    {% endif %}
    {% if original_slug %}
      <input type="hidden" name="original_slug" value="{{ original_slug }}">
    {% endif %}

    {# Form Fields (name, type, link, etc.) #}
    {# ... залишаємо як є ... #}

    {# === Conflict Resolution === #}
    {% if conflict %}
      <div class="conflict-box">
        <p class="conflict-text">Chat with this slug already exists. Choose what to do:</p>
        <div class="conflict-actions">
          <button type="submit" name="action" value="create_copy" class="btn btn-dark">Create Copy</button>
          <button type="submit" name="action" value="overwrite" class="btn btn-danger">Overwrite</button>
        </div>
      </div>
    {% endif %}

    {# === Form Actions === #}
    <div class="form-footer">
      <button type="submit" class="btn btn-primary">
        <img src="{{ url_for('static', filename='img/save_icon.png') }}" alt="Save"> Save
      </button>
      <a href="{% if chat and chat.slug %}
                  {{ url_for('chats.view_chat', slug=chat.slug) }}
                {% else %}
                  {{ url_for('chats.list_chats') }}
                {% endif %}"
        class="btn btn-secondary">
        Cancel
      </a>
    </div>
  </form>

  <p class="form-note"><span class="required-asterisk">*</span> Required field</p>
{% endblock %}
